Forgot my tablet...

LSH (Locality Sensitive Hashing) for the SET data-type.
- Fuzzy hashing that puts similar elements in the same buckets with high probability. 

# Jaccard Similarity
$J(A, B) = \frac{|A \cap B}{|A \cup B|}$
$0 \leq J(A,B) \leq 1$
$J(A, B)$ iif $A=B$
$J(A, B)$ iif $A, B$ are disjoint

### Problem Setup:
Let $A, B, ...$ be subsets of universe $U$.
Let $h:u\rightarrow[0,1]$ be a good "*collision-free*" hash function for "small" subsets in $U$.

For $A = {x_1, x_2, ..., x_n} \leq U$
Define $MH(A) = min_{i=1} h(x_i)$  (MH is Min-Hash)
**Claim**: For any $A, B \subseteq U$
- $Pr[MH(A) = MH(B) = J(A,B)]$
##### Proof:
- Watch lecture video.

#### First Try
Suppose we use "open hashing" or "separate chaining".
We have sets $\{A_1, A_2, A_3, ..., A_N\}$
We have some hash function, let's say $g(MH(A))$
- $g:[0,1] \rightarrow \{0, ..., m-1\}$ that is collision free.
	- i.e. use something like two-stage hashing to better guarantee "collision-free".
We have a hash table of length M:
- At location $i$ there is a chain (linked list) of $A_4, A_{10}, ...$ which $A_4, A_{10}, ...$ have been deemed as similar by the hash function.
- At location $j$ there is a chain of $A_5,...$ 
	- Contains ALL (no false negatives) $A_k$ which are similar to $A_5$.
	- No $A_L$ are "highly dis-similar with" 

Take $A, B$ with $J(A, B) = s$
###### Reduce false negatives with parameter $t$:
Use $t$ independent $(g_i, h_i)$ where $g$ is the hash function and $h$ is Min Hash:
Use $t$ different hash tables, all of size $M$.
- Suppose $g_1(h_1(A))$ places into hash table $t=1$.
- Suppose $g_2(h_2(A))$ places into hash table $t=2$.
- ...
- Suppose $g_t(h_t(A))$ places into hash table $t$.
**IDEA**: Output ALL sets that share a linked list anywhere with A. $\lhd$ what does this mean?
- $\therefore Pr[B$ NOT OUTPUT FOR $A] = (1-s)^t \leq e^{-st}$
###### Reduce false positives with parameter r:
Concatenate everything together:
- With t rows (t hash tables), put each result together.
- $MH_{1, 1}(A) \circ MH_{1, 2}(A), ..., \circ MH_{1, r}(A)$
- $MH_{2, 1}(A) \circ MH_{2, 2}(A), ..., \circ MH_{2, r}(A)$
- ...
- $MH_{t, 1}(A) \circ MH_{t, 2}(A), ..., \circ MH_{t, r}(A)$
For $MH_{i.j}$ we have $g_{i}(h_{j}(A))$
$Pr[A,B$ collide in row $i] = s^r$
$Pr[A,B$ don't collide in row $i] = 1-s^r$
$Pr[A,B$ don't collide in ANY row$] = (1-s^r)^t$
$Pr[A,B$ collide somewhere$] = 1-(1-s^r)^t = f_{r, t}(s)$
##### Relevancy: 
- Preventing the storage of redundant information in a highly storage and compute constrained environment.

## Example:
DB with 10M = 10^7 audio clips. Given some y, find (a "small" superset of) all $X$ with $J(X<Y) \leq 0.9$. Suppose:
(a) 10 "True Matches" $X$ with $J(X,Y) \leq 0.9$
(b) $\exists 10,000$ "near matches" $X$ with $0.7 \leq J(X,Y) \leq 0.9$.
(c) All other $X: J(X,Y) \lt 0.7$ 

#### Solution: Let $t=50, s=25$
(a) Each output with probability $\leq 1$. $\lhd$ How $\leq 1$?
(b) Each output with probability $\leq f_{r,t}(0.9) \approx 0.98$. 
(c) Each output with probability $\leq f_{25, 50}(0.7) \leq 0.07$
$\therefore E[$#items hit for $Y] \leq 10*1 + 10,000*0.98 + ($REST$)*0.07 \approx 80,000$

ALSO, any true match has $f_{25, 50} \geq f_{25, 50} (0.9) \approx 0.98$
$\therefore Pr[$Any given true match $X$ NOT output$] \leq 0.02$

